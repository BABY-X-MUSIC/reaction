name: Deploy Telegram Bot to Cloudflare Workers

on:
  push:
    branches:
      - main  # Trigger workflow on pushes to the main branch

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      # Checkout the repository code
      - name: Checkout repository
        uses: actions/checkout@v3

      # Install Wrangler (Cloudflare CLI tool)
      - name: Install Wrangler
        run: npm install -g wrangler

      # Authenticate Wrangler with Cloudflare API token from GitHub secrets
      - name: Authenticate Wrangler
        run: wrangler config --api-token ${{ secrets.CLOUDFLARE_API_TOKEN }}

      # Deploy the Worker to Cloudflare
      - name: Deploy to Cloudflare
        run: wrangler publish

      # Optionally tail logs for debugging
      - name: Tail Worker logs
        run: wrangler tail
